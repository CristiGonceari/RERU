<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
    <div class="card card-custom">
        <div class="card-header flex-wrap border-0 py-5">
            <div class="card-title font-weight-bolder" id="title">{{'evaluations.my-evaluations' | translate}}</div>
            <erp-shared-export-button class="mr-3 p-1" (click)="getHeaders(getTitle())">
                {{'button.export' | translate}}
            </erp-shared-export-button>
        </div>
      
        <div class="card-body pt-0">
            <app-loading-spinner *ngIf="isLoading" [contentHeight]="'40vh'" [height]="'5rem'"
                [width]="'5rem'" [colorClass]="'text-primary'">
            </app-loading-spinner>
            <div class="row mb-5 mt-0">
                <div class="col-xl col-12" *ngIf="showFilter">
                    <erp-shared-search-input (handleSearch)="setFilter('evaluationName', $event)"
                        [placeholder]="'verify-test.search-test-name' | translate" #evaluationName>
                    </erp-shared-search-input>
                </div>
                <div class="col-xl col-12" *ngIf="showFilter">
                    <erp-shared-search-input (handleSearch)="setFilter('evaluatedName', $event)"
                        [placeholder]="'verify-test.search-student' | translate" #evaluatedName>
                    </erp-shared-search-input>
                </div>
                <div class="col-xl col-12 pt-xl-0 pt-2">
                    <div class="input-group input-group-sm input-group-solid">
                        <input type="text" [owlDateTimeTrigger]="dtFrom"
                          class="form-control form-control-lg form-control-solid" [placeholder]="'events.search-from' | translate"
                          [value]="fromDate | dateFilter:'dd/MM/yyyy, HH:mm'" 
                          [readonly]="true" (ngModelChange)="setFilter('dtFrom', $event)">
                        <input style="position: absolute; width: 0; height: 0; border: 0;" class="shadow-input"
                          name="date_time" [(ngModel)]="fromDate" [owlDateTime]="dtFrom" [placeholder]="'events.search-from' | translate"
                          (ngModelChange)="setFilter('dtFrom', $event)"
                          [readonly]="true">
                          <i class="fas fa-calendar-alt mr-2"></i>
                        <owl-date-time #dtFrom></owl-date-time>
                    </div>
                </div>
                <div class="col-xl col-12 pt-xl-0 pt-2">
                    <div class="input-group input-group-sm input-group-solid">
                        <input type="text" [owlDateTimeTrigger]="toDate"
                          class="form-control form-control-lg form-control-solid" [placeholder]="'events.search-to' | translate"
                          [value]="tillDate | dateFilter:'dd/MM/yyyy, HH:mm'" 
                          [readonly]="true" (ngModelChange)="setFilter('toDate', $event)">
                        <input style="position: absolute; width: 0; height: 0; border: 0;" class="shadow-input"
                          name="date_time" [(ngModel)]="tillDate" [owlDateTime]="toDate" [placeholder]="'events.search-to' | translate"
                          (ngModelChange)="setFilter('toDate', $event)"
                          [readonly]="true">
                          <i class="fas fa-calendar-alt mr-2"></i>
                        <owl-date-time #toDate></owl-date-time>
                    </div>
                </div>
                <div class="col-xl-auto col-12 pt-xl-0 pt-2">
                    <div class="text-right d-xl-block d-none">
                        <app-button (handle)="resetFilters()" [value]="'button.reset' | translate"></app-button>
                    </div>
                    <div class="text-right d-xl-none d-block">
                        <app-button width="100%" (handle)="resetFilters()" [value]="'button.reset' | translate"></app-button>
                    </div>
                </div>
            </div>
            <div class="table-responsive datatable datatable-bordered datatable-default datatable-loaded" id="kt_datatable">
                <table for="kt_datatable" class="datatable table" style="overflow: visible" id="evaluatedTestTable"
                    *ngIf="!isLoading">
                    <thead class="text-uppercase text-muted">
                        <tr>
                            <th scope="col">{{'evaluations.evaluation' | translate}}</th>
                            <th scope="col">{{'verify-test.student' | translate}} ({{ 'user-profile.npp' | translate }})</th>
                            <th scope="col">{{'events.event' | translate}}</th>
                            <th scope="col">{{'dashboard.status' | translate}}</th>
                            <th scope="col" class="text-center">{{ 'verify-test.result' | translate }}</th>
                            <th scope="col">{{ 'button.actions' | translate }}</th>
                        </tr>
                    </thead>
                    <tbody class="datatable-body" *ngIf="testRowList.length">
                        <tr *ngFor="let test of testRowList">
                            <td>
                                <b>{{ test.testTemplateName }}</b>
                                <span class="text-dark-50 d-block mb-0">
                                    {{ test.endTime | date: 'dd/MM/yyyy, HH:mm'}}
                                </span>
                            </td>
                            <td>
                                <p class="font-size-lg cursor-pointer text-hover-primary mb-0"
                                    [routerLink]="['../../user-profile', test.userId]" style="white-space: nowrap;">
                                    {{ test.userName }}
                                    <br>
                                    <span class="text-dark-50 font-size-lg font-weight-light">{{ test.idnp }}</span>
                                </p>
                            </td>
                            <td>
                                <span class="font-size-lg" *ngIf="test.eventName">{{ test.eventName }}</span>
                                <span class="font-size-lg" *ngIf="!test.eventName">-</span>
                            </td>
                            <td>
                                <div class="font-size-sm">
                                    <span class="text-dark-50" *ngIf="test.testStatus == enum.AlowedToStart">
                                        {{'statuses.AlowedToStart' | translate}}
                                    </span>
                                    <span class="text-dark-50" *ngIf="test.testStatus == enum.InProgress">
                                        {{'statuses.started' | translate}}
                                    </span>
                                    <span class="text-dark-50" *ngIf="test.testStatus == enum.Terminated">
                                        {{'statuses.Terminated' | translate}}
                                    </span>
                                    <span class="text-dark-50" *ngIf="test.testStatus == enum.Verified">
                                        {{'statuses.Verified' | translate}}
                                    </span>
                                    <span class="text-dark-50" *ngIf="test.testStatus == enum.Closed">
                                        {{'statuses.Closed' | translate}}
                                    </span>
                                    <span class="text-dark-50" *ngIf="test.testStatus == enum.Programmed">
                                        {{'verify-test.status-0' | translate}}
                                    </span>
                                </div>
                            </td>
                            <td class="text-center">{{ translateResultValue(test.resultValue) }}</td>
                            <td>
                                <button *ngIf="test.testStatus == enum.InProgress" class="btn btn-sm btn-light-warning"
                                    [routerLink]="['../performing-evaluation', test.id]">
                                    {{'button.continue' | translate}}
                                </button>
                                <button
                                    *ngIf="test.testStatus == enum.Programmed || test.testStatus == enum.AlowedToStart"
                                    class="btn btn-sm btn-light-success" [routerLink]="['../start-evaluation', test.id]">
                                    {{'evaluations.start-evaluation' | translate}}
                                </button>
                                <button *ngIf="test.result != resultEnum.NoResult"
                                    class="btn btn-sm btn-blue" [routerLink]="['../evaluation-result', test.id]">
                                    {{'tests.view' | translate}}
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody class="datatable-body" *ngIf="!testRowList.length">
                        <tr>
                            <td colspan="6" class="text-center">
                                {{ 'message.no-record' | translate }}
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div pagination class="datatable-pager datatable-paging-loaded" [page]="pagedSummary.currentPage"
                    *ngIf="testRowList.length" [total]="pagedSummary.totalPages"
                    [totalRecords]="pagedSummary.totalCount" [size]="pagedSummary.pageSize"
                    (sizeChange)="getUserTests({ page: 1, itemsPerPage: $event })"
                    (pageChange)="getUserTests({ page: $event, itemsPerPage: pagedSummary.pageSize })">
                </div>
            </div>

        </div>
    </div>
</div>