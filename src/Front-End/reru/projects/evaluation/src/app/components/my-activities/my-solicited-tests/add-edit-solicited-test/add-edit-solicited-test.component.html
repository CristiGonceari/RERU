<app-page-title title="{{ 'solicited-test.subtitle' | translate }}"
    subTitle="{{ 'solicited-test.test-data' | translate }}">
</app-page-title>

<app-loading-spinner *ngIf="isLoading" [contentHeight]="'80vh'" [height]="'5rem'" [width]="'5rem'"
    [colorClass]="'text-primary'">
</app-loading-spinner>

<erp-shared-content *ngIf="!isLoading">
    <form [formGroup]="addEditSolicitedPositionForm">
    <div class="card card-custom gutter-b erp-shared-desktop-wide">
        <div class="card-body p-0">
            <div class="wizard wizard-1" id="kt_contact_add" data-wizard-state="step-first"
                data-wizard-clickable="true">
                <div class="row justify-content-center my-10 px-8 my-lg-15 px-lg-10" *ngIf="!isLoadingMedia">
                    <div class="col-xl-12 col-xxl-7">
                        <div class="form" id="kt_contact_add_form">
                            <div class="pb-5" data-wizard-type="step-content" data-wizard-state="current">
                                <h3 class="mb-10 font-weight-bold text-dark">{{'solicited-test.test-details' |
                                    translate}}</h3>
                                <div class="row">
                                    <div class="col-xl-12">
                                        <div class="form-group row">
                                            <label class="col-xl-3 col-lg-3 col-form-label text-center text-sm-left text-lg-right">{{
                                                'solicited-test.position-to-candidate' | translate }}</label>
                                            <div class="col-lg-9 col-xl-9">
                                                <div *ngIf="isEdit"
                                                    class="form-control form-control-lg form-control-solid">
                                                    {{selected.label}}
                                                </div>
                                                <select class="form-control form-control-lg form-control-solid"
                                                    *ngIf="!isEdit" name="selectedStatus" id="selectedStatus"
                                                     formControlName="candidatePositionId"
                                                    (change)="getEventsAndDocuments()">
                                                    <option selected disabled hidden value="null">{{'solicited-test.select-candidate-position' | translate}}</option>
                                                    <option *ngFor="let item of candidatePositions"
                                                        [ngValue]="item.value">
                                                        {{ item.label }}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                        <div *ngIf="showCard">
                                            <div class="form-group row"
                                                *ngFor="let event of eventsWithTestList">
                                                <label class="col-xl-3 col-lg-3 col-form-label text-center text-sm-left text-lg-right">{{
                                                    'events.event' | translate }}</label>
                                                <div class="col-lg-9 col-xl-9 col-form-label">
                                                    <p>{{ event.eventName }} :</p>
                                                    <ol>
                                                        <li *ngFor="let item of event.testTemplateNames">{{ item
                                                            }}</li>
                                                    </ol>
                                                </div>
                                            </div>
                                        </div>
                                        <div *ngIf="showCard && !isEdit">
                                            <div class="form-group row"
                                                *ngFor="let requiredDocument of requiredDocumentsList; let i = index">
                                                <label class="col-xl-3 col-lg-3 col-form-label text-center text-sm-left text-lg-right">{{
                                                    requiredDocument.name }}</label>
                                                <div class="col-lg-9 col-xl-9">
                                                    <div class="form-group row">
                                                        <div class="col">
                                                            <!-- <input
                                                                (change)="setFile($event, i, requiredDocument.id)"
                                                                class="form-control" type="file" name="file"
                                                                id="file" required> -->
                                                            <app-add-document (handleFile)="setFile($event, i, requiredDocument.id)"></app-add-document>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <app-loading-spinner *ngIf="isDeleting" [contentHeight]="'20vh'"
                                            [height]="'5rem'" [width]="'5rem'" [colorClass]="'text-primary'">
                                        </app-loading-spinner>
                                        <div *ngIf="showCard && isEdit && !isDeleting">
                                            <div class="form-group row"
                                                *ngFor="let item of userFiles; let i = index">
                                                <label class="col-xl-3 col-lg-3 col-form-label text-right">
                                                    {{ item.requiredDocumentName }}</label>
                                                <div class="col-lg-9 col-xl-9">
                                                    <button *ngIf="item.fileName.length > 0"
                                                        (click)="GetFile(item.fileId)"
                                                        class="btn btn-light-success font-weight-bold mr-3"
                                                        ngbTooltip="{{item.fileName}}">
                                                        <i class="flaticon-profile"></i>
                                                        {{ ceckFileNameLength(item.fileName) }}
                                                    </button>
                                                    <span *ngIf="item.fileName.length > 0"
                                                        (click)="deleteFile(item.fileId)"
                                                        class="svg-icon svg-icon-primary svg-icon-2x">
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                            xmlns:xlink="http://www.w3.org/1999/xlink"
                                                            width="24px" height="24px" viewBox="0 0 24 24"
                                                            version="1.1">
                                                            <g stroke="none" stroke-width="1" fill="none"
                                                                fill-rule="evenodd">
                                                                <g transform="translate(12.000000, 12.000000) rotate(-45.000000) translate(-12.000000, -12.000000) translate(4.000000, 4.000000)"
                                                                    fill="#000000">
                                                                    <rect x="0" y="7" width="16" height="2"
                                                                        rx="1" />
                                                                    <rect opacity="0.3"
                                                                        transform="translate(8.000000, 8.000000) rotate(-270.000000) translate(-8.000000, -8.000000) "
                                                                        x="0" y="7" width="16" height="2"
                                                                        rx="1" />
                                                                </g>
                                                            </g>
                                                        </svg>
                                                    </span>
                                                    <b *ngIf="!item.fileName.length > 0">
                                                        <div class="col-lg-9 col-xl-9">
                                                            <div class="form-group row">
                                                                <div class="col">
                                                                    <!-- <input
                                                                        (change)="setFile($event, i, item.requiredDocumentId)"
                                                                        class="form-control" type="file"
                                                                        name="file" id="file" required> -->
                                                                        <app-add-document (handleFile)="setFile($event, i, item.requiredDocumentId)"></app-add-document>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </b>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-md-block d-none text-right pt-10">
                                    <app-button  class="btn mr-2" [value]="'button.cancel' | translate"
                                        (handle)="backClicked()">
                                    </app-button>
                                    <app-add-button class="btn mr-2" [value]="'button.confirm' | translate"
                                        (handle)="onSave()" [disable]="!candidatePositions">
                                    </app-add-button>
                                </div>
                                <div class="d-md-none d-block pt-10">
                                    <app-add-button width="100%" [disabled]="cantAdd()" class="btn w-100" [value]="'button.confirm' | translate"
                                        (handle)="onSave()">
                                    </app-add-button>
                                    <app-button width="100%" class="btn w-100" [value]="'button.cancel' | translate"
                                        (handle)="backClicked()">
                                    </app-button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="justify-content-center my-10 px-8 my-lg-15 px-lg-10" *ngIf="isLoadingMedia">
                    <!-- <mat-progress-bar mode="indeterminate"></mat-progress-bar> -->
                    <div class="progress mt-2 h-25px">
                      <div [style.width.%]="fileStatus.percent"
                        class="progress-bar progress-bar-animated btn-light-warning font-size-h6" role="progressbar"
                        aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
                        {{ fileStatus.requestType }} {{ fileStatus.percent }}%
                      </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
</erp-shared-content>
