<app-event-calendar 
    (onDatePicked)="getListByDate($event)" 
    (listOfDates)="getUserTests($event)"
    (listOfCountedEvents)="getListOfCoutedTests($event)">
</app-event-calendar>
<div class="datatable datatable-bordered datatable-head-custom datatable-default datatable-primary datatable-loaded"
    id="kt_datatable">

    <app-loading-spinner *ngIf="isLoading"></app-loading-spinner>

    <div class="card" *ngIf="!isLoading">
        <div class="card-header text-center" *ngIf="selectedDay != null">
            {{ 'calendar.selected-date' | translate }}: {{displayDate}}
        </div>
        <div class="card-body">
            <table for="kt_datatable" class="datatable table" style="overflow: visible">
                <thead class="text-uppercase text-muted">
                    <tr>
                        <th scope="col" class="colored">
                            <b>{{'dashboard.date-status' | translate}}</b>
                            <i class="fas fa-arrow-down ml-1 colored"></i>
                        </th>
                        <th scope="col">{{'dashboard.test' | translate}}</th>
                        <th scope="col" style="width: 170px;">
                            {{'dashboard.score' | translate}} / {{'dashboard.min-score' | translate}}
                        </th>
                        <th scope="col" style="width: 120px"></th>
                    </tr>
                </thead>
                <tbody class="datatable-body" *ngIf="testRowList.length">
                    <tr *ngFor="let test of testRowList">
                        <td>
                            <span class="colored d-block mb-0">
                                <b>{{ test.programmedTime | date: 'dd/MM/yyyy, HH:mm'}}</b>
                            </span>
                            <div class="font-size-sm">
                                <span class="text-dark-50" *ngIf="test.testStatus == enum.AlowedToStart">
                                    {{'statuses.AlowedToStart' | translate}}
                                </span>
                                <span class="text-dark-50" *ngIf="test.testStatus == enum.InProgress">
                                    {{'statuses.started' | translate}}
                                </span>
                                <span class="text-dark-50" *ngIf="test.testStatus == enum.Terminated">
                                    {{'statuses.Terminated' | translate}}
                                </span>
                                <span class="text-dark-50" *ngIf="test.testStatus == enum.Verified">
                                    {{'statuses.Verified' | translate}}
                                </span>
                                <span class="text-dark-50" *ngIf="test.testStatus == enum.Closed">
                                    {{'statuses.Closed' | translate}}
                                </span>
                                <span class="text-dark-50" *ngIf="test.testStatus == enum.Programmed">
                                    {{'verify-test.status-0' | translate}}
                                </span>
                            </div>
                        </td>
                        <td><b>{{ test.testTemplateName }}</b></td>
                        <td>
                            <b *ngIf="test.result == resultEnum.NoResult"> - / {{test.minPercent}}%</b>
                            <b *ngIf="test.result != resultEnum.NoResult">{{ test.accumulatedPercentage }}% /
                                {{test.minPercent}}%</b>
                        </td>
                        <td>
                            <button *ngIf="test.testStatus == enum.InProgress" class="btn btn-light-success"
                                (click)="getTestById(test.id)">
                                {{'button.continue' | translate}}
                            </button>
                            <button *ngIf="test.testStatus == enum.Programmed || test.testStatus == enum.AlowedToStart"
                                class="btn btn-light-success" [routerLink]="['../start-test', test.id]">
                                {{'button.start-test' | translate}}
                            </button>
                            <button
                                *ngIf="test.viewTestResult && (test.result == resultEnum.NotPassed || test.result == resultEnum.Passed)"
                                class="btn btn-light-success" [routerLink]="['../test-result', test.id]">
                                {{'tests.view' | translate}}
                            </button>
                        </td>
                    </tr>
                </tbody>
                <tbody class="datatable-body" *ngIf="!testRowList.length">
                    <tr>
                        <td colspan="6" class="text-center">
                            {{ 'message.no-record' | translate }}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div pagination class="datatable-pager datatable-paging-loaded" [page]="pagedSummary.currentPage"
        *ngIf="selectedDay == null" [total]="pagedSummary.totalPages" [totalRecords]="pagedSummary.totalCount"
        [size]="pagedSummary.pageSize"
        (sizeChange)="getUserTests({ page: 1, itemsPerPage: $event })"
        (pageChange)="getUserTests({ page: $event, itemsPerPage: pagedSummary.pageSize} )">
    </div>
    <div pagination class="datatable-pager datatable-paging-loaded" [page]="pagedSummary.currentPage"
        *ngIf="selectedDay != null" [total]="pagedSummary.totalPages" [totalRecords]="pagedSummary.totalCount"
        [size]="pagedSummary.pageSize"
        (sizeChange)="getListByDate({ page: 1, itemsPerPage: $event })"
        (pageChange)="getListByDate({ page: $event, itemsPerPage: pagedSummary.pageSize })">
    </div>
</div>
