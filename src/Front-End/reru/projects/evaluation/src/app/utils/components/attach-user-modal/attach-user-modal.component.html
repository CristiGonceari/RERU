<div class="modal-header px-7">
	<h3 class="modal-title">{{'events.attach-user' | translate}}</h3>
</div>
<div class="modal-body px-7">
	<div class="row mb-lg-2 mb-0">
		<div class="col-lg col-12">
			<erp-shared-search-input (handleSearch)="setFilter('lastName', $event)"
				[placeholder]="'login.last-name' | translate" #lastName></erp-shared-search-input>
		</div>
		<div class="col-lg col-12 pt-lg-0 pt-2">
			<erp-shared-search-input (handleSearch)="setFilter('firstName', $event)"
				[placeholder]="'login.first-name' | translate" #firstName></erp-shared-search-input>
		</div>
		<div class="col-lg col-12 pt-lg-0 pt-2">
			<erp-shared-search-input (handleSearch)="setFilter('fatherName', $event)"
			[placeholder]="'login.father-name' | translate" #fatherName></erp-shared-search-input>
		</div>
		<div class="col-lg col-12 pt-lg-0 pt-2">
			<erp-shared-search-input (handleSearch)="setFilter('idnp', $event)"
				[placeholder]="'login.idnp' | translate" #idnp></erp-shared-search-input>
		</div>
		<div class="col-lg col-12 pt-lg-0 pt-2">
			<erp-shared-search-input (handleSearch)="setFilter('email', $event)"
				[placeholder]="'user-profile.user-email'  | translate" #email></erp-shared-search-input>
		</div>
		<div class="col-lg col-12 pt-lg-0 pt-2">
			<erp-shared-search-input (handleSearch)="setFilter('colaboratorId', $event)"
				[placeholder]="'login.colaborator-id'  | translate" #colaboratorId></erp-shared-search-input>
		</div>
	</div>
	<div class="row">
		<div class="col-lg col-12 pt-lg-0 pt-2">
			<app-search-department (filter)="setFilter('departmentId',  $event)" #departmentId></app-search-department>
		</div>
		<div class="col-lg col-12 pt-lg-0 pt-2">
			<app-search-role (filter)="setFilter('roleId',  $event)" #roleId></app-search-role>
		</div>
		<div class="col-lg col-12 pt-lg-0 pt-2">
			<app-search-status (filter)="setFilter('userStatusEnum',  $event)" #userStatusEnum></app-search-status>
		</div>
		<div class="d-lg-block d-none col-lg-auto col-12 pt-lg-0 pt-2">
			<app-button class="block" (click)="resetFilters()">{{'button.reset-filters' | translate}}</app-button>
		</div>
		<div class="d-lg-none d-block col-lg-auto col-12 pt-lg-0 pt-2">
			<app-button class="w-100" width="100%" (click)="resetFilters()">{{'button.reset-filters' | translate}}</app-button>
		</div>
	</div>

	<app-loading-spinner *ngIf="isLoading" [contentHeight]="'40vh'" [height]="'5rem'" [width]="'5rem'"
		[colorClass]="'text-primary'">
	</app-loading-spinner>


		<!-- <div *ngIf="page == 'evaluators'" class="d-flex align-items-center mb-5">
			<span class="h3 mb-0 pr-2">{{ 'events.show-user-name' | translate }}: </span>
			<span>{{ 'button.no' | translate }}</span>
			<span class="switch switch-primary switch-sm mx-3">
				<label>
					<input type="checkbox" checked="checked" name="select" (change)="checkEvent($event)">
					<span></span>
				</label>
			</span>
			<span>{{ 'button.yes' | translate }}</span>
		</div> -->
		
		<p>{{ 'events.attached-users' | translate }}: {{attachedItems.length}}</p>
		<div class="table-responsive datatable datatable-bordered datatable-head-custom datatable-default datatable-primary datatable-loaded"
		id="kt_datatable">
		<table class="datatable table font-size-lg" style="overflow: visible" *ngIf="!isLoading">
			<thead class="text-uppercase text-muted">
				<tr>
					<th scope="col" style="width: 50px">
						<span>
							<label class="checkbox checkbox-lg checkbox-inline" [ngbTooltip]="tooltip" *ngIf="inputType !== 'radio'">
								<input type="checkbox" value="" name="option"
									[checked]="paginatedAttachedIds"
									[disabled]="!users.length" 
									(change)="checkAll($event)" />
								<span></span>
							</label>
						</span>
					</th>
					<th scope="col"> {{ 'login.last-name' | translate }} ({{ 'user-profile.npp' | translate }}) </th>
					<th scope="col"> {{ 'login.idnp' | translate }} </th>
					<th scope="col"> {{ 'user-profile.user-email' | translate }} </th>
					<th scope="col"> {{ 'departments.department' | translate }} </th>
					<th scope="col"> {{ 'user-roles.role' | translate }} </th>
				</tr>
			</thead>
			<tbody class="datatable-body">
				<tr *ngFor="let user of users">
					<td>
						<label class="checkbox checkbox-lg checkbox-inline">
							<input #currentCheckbox type="{{inputType}}" value="{{ user.id }}" name="option"
								[checked]="attachedItems.includes(user.id)" (change)="checkInput($event)" />
							<span></span>
						</label>
					</td>
					<td> <a class="text-dark-75 text-hover-primary" (click)="currentCheckbox.click()" href="javascript:void(0)">{{ user.lastName }} {{ user.firstName }} {{ user.fatherName }}</a></td>
					<td> {{ user.idnp }} </td>
					<td> {{ user.email }} </td>
					<td>
						<span *ngIf="!user.departmentName">-</span> 
						<span *ngIf="user.departmentName">{{ user.departmentName }}</span> 
					</td>
					<td> 
						<span *ngIf="!user.roleName">-</span> 
						<span *ngIf="user.roleName">{{ user.roleName }}</span>
					</td>
				</tr>
			</tbody>
			<tbody class="datatable-body">
				<tr *ngIf="!users.length">
					<td colspan="6" class="text-center">
						{{ 'message.no-record' | translate }}
					</td>
				</tr>
			</tbody>
		</table>
		<div pagination class="datatable-pager datatable-paging-loaded mb-5" [page]="pagination.currentPage" 
			*ngIf="users" [total]="pagination.totalPages" [totalRecords]="pagination.totalCount" [size]="pagination.pageSize"
			(sizeChange)="getUsers({ page: 1, itemsPerPage: $event})"
			(pageChange)="getUsers({ page: $event, itemsPerPage: pagination.pageSize})">
		</div>
		</div>
	</div>

<div class="modal-footer d-lg-flex d-none">
	<button type="button" class="btn btn-secondary" (click)="dismiss()">{{'button.cancel' | translate}}</button>
	<button type="button" class="btn btn-primary" [disabled]="attachedItems.length < 1 && (page == 'add-test' || page == 'add-evaluation')" (click)="confirm()">{{'button.confirm' | translate}}</button>
</div>
<div class="modal-footer d-lg-none d-flex">
	<button type="button" class="btn btn-primary w-100" [disabled]="attachedItems.length<1 && (page == 'add-test' || page == 'add-evaluation')" (click)="confirm()">{{'button.confirm' | translate}}</button>
	<button type="button" class="btn btn-secondary w-100 pt-2" (click)="dismiss()">{{'button.cancel' | translate}}</button>
</div>
<ng-template #tooltip>
	<p class="mb-0 font-size-sm" *ngIf="paginatedAttachedIds">{{'button.uncheck-all' | translate}}</p>
	<p class="mb-0 font-size-sm" *ngIf="!paginatedAttachedIds">{{'button.check-all' | translate}}</p>
</ng-template>
