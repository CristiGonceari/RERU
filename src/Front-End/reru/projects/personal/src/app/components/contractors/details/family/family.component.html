<div class="card card-custom card-stretch">
    <div class="card-header py-3">
        <div class="card-title align-items-start flex-column">
            <h3 class="card-label font-weight-bolder">{{'personal.family-component' | translate}}</h3>
            <span class="text-muted font-weight-bold font-size-sm mt-1">{{'personal.change-your-account-details' | translate}}</span>
        </div>
        <div class="card-toolbar">
            <div class="row justify-content-end mt-10 mr-1">
                <button class="btn btn-success"
                [disabled]="(materialStatusForm && materialStatusForm.invalid || userMaterialStatus == null)"
                (click)="addRegistrationFluxStep()"
                    >{{'stepper.button-next' | translate}}</button>
            </div>
        </div>
    </div>
    <app-loading-spinner *ngIf="isLoading" [contentHeight]="'20rem'" [height]="'5rem'" [width]="'5rem'" [colorClass]="'text-primary'"></app-loading-spinner>
    <div *ngIf="!isLoading" class="card-body">
        <!-- <div *ngIf="!isLoading" class="table-responsive datatable datatable-default">
            <table class="table erp-table">
                <thead>
                    <tr>
                        <th [ngStyle]="{'width.%' : 20}">{{'entity.family-component.first-name' | translate}}</th>
                        <th [ngStyle]="{'width.%' : 20}">{{'entity.family-component.last-name' | translate}}</th>
                        <th [ngStyle]="{'width.%' : 25}">{{'entity.family-component.birthday' | translate}}</th>
                        <th [ngStyle]="{'width.%' : 20}">{{'entity.family-component.relation-name' | translate}}</th>
                        <th [ngStyle]="{'width.%' : 15}" class="text-right">{{'entity.family-component.actions' | translate}}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of families; let i = index">
                        <td [ngStyle]="{'width.%' : 20}">{{item.firstName || '-'}}</td>
                        <td [ngStyle]="{'width.%' : 20}">{{item.lastName || '-'}}</td>
                        <td [ngStyle]="{'width.%' : 25}">{{item.birthday | date: 'dd.MM.yyyy'}}</td>
                        <td [ngStyle]="{'width.%' : 20}">{{item.relationName || '-'}}</td>
                        <td [ngStyle]="{'width.%' : 15}" class="text-right">
                            <app-family-dropdown (delete)="openDeleteFamilyModal(item)" (edit)="openEditFamilyModal(item)"></app-family-dropdown>
                        </td>
                    </tr>
                    <tr *ngIf="!families || !families.length">
                        <td colspan="100" class="text-center">
                            {{'word.there-are-no-records-at-the-moment' | translate}}
                            <div class="text-center">
                                <span class="svg-icon svg-icon-primary svg-icon-10x">
                                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                        <rect x="0" y="0" width="24" height="24"/>
                                        <path d="M11.1669899,4.49941818 L2.82535718,19.5143571 C2.557144,19.9971408 2.7310878,20.6059441 3.21387153,20.8741573 C3.36242953,20.9566895 3.52957021,21 3.69951446,21 L21.2169432,21 C21.7692279,21 22.2169432,20.5522847 22.2169432,20 C22.2169432,19.8159952 22.1661743,19.6355579 22.070225,19.47855 L12.894429,4.4636111 C12.6064401,3.99235656 11.9909517,3.84379039 11.5196972,4.13177928 C11.3723594,4.22181902 11.2508468,4.34847583 11.1669899,4.49941818 Z" fill="#000000" opacity="0.3"/>
                                        <rect fill="#000000" x="11" y="9" width="2" height="7" rx="1"/>
                                        <rect fill="#000000" x="11" y="17" width="2" height="2" rx="1"/>
                                    </g>
                                </svg>
                                </span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div pagination [page]="pagedSummary.currentPage" [total]="pagedSummary.totalPages" [size]="pagedSummary.pageSize" (sizeChange)="list({ page: pagedSummary.currentPage, itemsPerPage: $event })"
                (pageChange)="list({ page: $event })" class="datatable-pager datatable-paging-loaded">
            </div>
        </div> -->
        <form *ngIf="materialStatusForm" class="col border" [formGroup]="materialStatusForm">
            <app-loading-spinner *ngIf="isLoadingMaterialStatus" contentHeight="20rem" height="5rem" width="5rem"
            colorClass="text-primary"></app-loading-spinner>
            <div *ngIf="!isLoadingMaterialStatus" >
                <div class="row my-5">
                    <div class="col">
                        <h4>{{'step.MaterialStatus' | translate}}</h4>
                    </div>
                </div>
                <div class="row ml-10" >
                    <div class="col-xl-9 col-9">
                        <div class="form-group row required">
                            <label class="col-xl-5 col-lg-6 col-form-label"
                                for="materialStatusTypeId">{{'material-status.name' | translate}}</label>
                            <div class="col-lg-9 col-xl-6">
                                <select class="form-control" formControlName="materialStatusTypeId">
                                    <option value="null">{{'module-access.select' | translate}}</option>
                                    <option *ngFor="let item of materialStatusTypes" [value]="item.value">{{ 'materialStatusType.' + item.translateId | translate}}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
        
                </div>
                <div class="row justify-content-end m-7">
                    <button class="btn btn-success" *ngIf="addOrEditMaterialStatusButton"
                        [disabled]="(materialStatusForm.value.materialStatusTypeId == null) || (materialStatusForm.value.materialStatusTypeId == 'null')" (click)="updateMaterialStatus()">{{'stepper.button-update' | translate}}</button>
                    <button class="btn btn-success" *ngIf="!addOrEditMaterialStatusButton"
                        [disabled]="materialStatusForm.value.materialStatusTypeId == null || (materialStatusForm.value.materialStatusTypeId == 'null')" (click)="createMaterialStatus()">{{'stepper.button-add' | translate}}</button>
                </div>
            </div>
        </form>
        <form *ngIf="kinshipRelationWithUserProfileForm" class="col border" [formGroup]="kinshipRelationWithUserProfileForm">
            <app-loading-spinner *ngIf="isLoadingKinshipRelationWithUserProfile" contentHeight="20rem" height="5rem" width="5rem"
                colorClass="text-primary"></app-loading-spinner>
            <div *ngIf="!isLoadingKinshipRelationWithUserProfile">
                <div class="row my-5">
                    <div class="col">
                        <h4>{{'material-status.kinship-relation' | translate}}</h4>
                    </div>
                </div>
                <div formArrayName="relationWithUserProfile" class="ml-10">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">{{ 'table.number' | translate }}</th>
                                <th scope="col">{{ 'material-status.kinship-degree' | translate }}</th>
                                <th scope="col">{{ 'material-status.user-name' | translate}}</th>
                                <th scope="col">{{ 'material-status.last-name' |translate }}</th>
                                <th scope="col">{{ 'material-status.table-function' | translate}} </th>
                                <th scope="col">{{ 'material-status.table-subdivision' | translate }}</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr [ngClass]="{'more': kinshipRelationWithUserProfileForm.controls.relationWithUserProfile.controls.length > 1  &&
                                                (kinshipRelationWithUserProfileForm.controls.relationWithUserProfile.controls.length - 1) !== i}"
                                *ngFor="let relation of kinshipRelationWithUserProfileForm.controls.relationWithUserProfile.controls; let i = index"
                                [formGroupName]="i">
                                <th scope="row">{{i + 1}}</th>
                                <td>
                                    <select class="form-control" formControlName="kinshipDegree">
                                        <option value="null">{{'module-access.select' | translate}}</option>
                                        <option *ngFor="let item of kinshipDegreeEnum" [value]="item.value">{{ 'kinshipDegree.' + item.label | translate}}
                                        </option>
                                    </select>
                                </td>
                                <td>
                                    <input formControlName="name" autocomplete="off"
                                    class="form-control form-control-solid" type="text"
                                    [placeholder]="'material-status.user-name' | translate" />
                                </td>
                                <td>
                                    <input formControlName="lastName" autocomplete="off"
                                    class="form-control form-control-solid" type="text"
                                    [placeholder]="'material-status.last-name' | translate" />
                                </td>
                                <td>
                                    <input formControlName="function" autocomplete="off"
                                    class="form-control form-control-solid" type="text"
                                    [placeholder]="'material-status.table-function' | translate" />
                                </td>
                                <td>
                                    <input formControlName="subdivision" autocomplete="off"
                                    class="form-control form-control-solid" type="text"
                                    [placeholder]="'material-status.table-subdivision' | translate" />
                                </td>
                                <td>
                                    <div *ngIf="i > 0" class="row justify-content-end mb-3 mr-7">
                                        <button class="btn btn-icon" (click)="removeKinshipRelationWithUserProfile(i)">
                                            <span class="font-size-18px">&times;</span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
        
                    </table>
                </div>
                <div class="row justify-content-between ml-10">
                    <button class="btn btn-icon" (click)="addKinshipRelationWithUserProfile()"><span class="font-size-18px">+</span></button>
                </div>
                <div class="row justify-content-end m-7">
                    <button class="btn btn-success" *ngIf="addOrEditKinshipRelationWithUserProfileButton"
                        [disabled]="kinshipRelationWithUserProfileForm && kinshipRelationWithUserProfileForm.invalid "(click)="creteKinshipRelationWithUserProfile()">{{'stepper.button-update' | translate}}</button>
                    <button class="btn btn-success" *ngIf="!addOrEditKinshipRelationWithUserProfileButton"
                        [disabled]="kinshipRelationWithUserProfileForm && kinshipRelationWithUserProfileForm.invalid" (click)="creteKinshipRelationWithUserProfile()">{{'stepper.button-add' | translate}}</button>
                </div>
            </div>
        </form>
        <form *ngIf="kinshipRelationForm" class="col border" [formGroup]="kinshipRelationForm">
            <app-loading-spinner *ngIf="isLoadingKinshipRelation" contentHeight="20rem" height="5rem" width="5rem"
                colorClass="text-primary"></app-loading-spinner>
            <div *ngIf="!isLoadingKinshipRelation">
                <div class="row my-5">
                    <div class="col">
                        <h4>{{'material-status.biography-data' | translate}}</h4>
                    </div>
                </div>
                <div formArrayName="relation">
                    <table class="table table-bordered border-dark mb-10" [ngClass]="{'more': kinshipRelationForm.controls.relation.controls.length > 1  &&
                        (kinshipRelationForm.controls.relation.controls.length - 1) !== i}"
                        *ngFor="let relation of kinshipRelationForm.controls.relation.controls; let i = index"
                        [formGroupName]="i">
                        <tbody>
                            <tr>
                            <th>{{ 'table.number' | translate}}</th>
                            <td >
                                {{i + 1}}
                            </td>
                          </tr>
                          <tr >
                            <th>{{ 'material-status.kinship-degree' | translate }} </th>
                            <td>
                                <select class="form-control" formControlName="kinshipDegree">
                                <option value="null">{{'module-access.select' | translate}}</option>
                                <option *ngFor="let item of kinshipDegreeEnum" [value]="item.value">{{ 'kinshipDegree.' + item.label | translate}}
                                </option>
                            </select></td>
                          </tr>
                          <tr>
                            <th>{{'material-status.user-name' | translate}}</th>
                            <td>
                                <input formControlName="name" autocomplete="off"
                                    class="form-control form-control-solid" type="text"
                                    [placeholder]="'material-status.user-name' | translate" />
                            </td>
                          </tr>
                          <tr>
                            <th>{{'material-status.last-name' | translate}}</th>
                            <td>
                                <input formControlName="lastName" autocomplete="off"
                                    class="form-control form-control-solid" type="text"
                                    [placeholder]="'material-status.last-name' | translate" />
                            </td>
                          </tr>
                          <tr>
                            <th>{{ 'material-status.birthday-date' | translate}}</th>
                            <td >
                                <app-date [parent]="relation" [date]="'birthDate'"
                                        [placeholder]="'material-status.birthday-date' | translate"></app-date>
                                    </td>
                          </tr>
                          <tr>
                            <th>{{'material-status.birth-place' | translate}}</th>
                            <td>
                                <input formControlName="birthLocation" autocomplete="off"
                                    class="form-control form-control-solid" type="text"
                                    [placeholder]="'material-status.birth-place' | translate" />
                            </td>
                          </tr>
                          <tr>
                            <th>{{ 'material-status.table-function' | translate }}</th>
                            <td>
                                <input formControlName="function" autocomplete="off"
                                    class="form-control form-control-solid" type="text"
                                    [placeholder]="'material-status.table-function' | translate" />
                            </td>
                          </tr>
                          <tr>
                            <th>{{ 'material-status.work-place' | translate}}</th>
                            <td>
                                <input formControlName="workLocation" autocomplete="off"
                                    class="form-control form-control-solid" type="text"
                                    [placeholder]="'material-status.work-place' | translate" />
                            </td>
                          </tr>
                          <tr>
                            <th>{{ 'material-status.residence' | translate}}</th>
                            <td>
                                <input formControlName="residenceAddress" autocomplete="off"
                                class="form-control form-control-solid" type="text"
                                [placeholder]="'material-status.residence' | translate" />
                            </td>
                          </tr>
                          <tr>
                            <th></th>
                            <td>
                                <div  class="justify-content-end">
                                    <button class="btn btn-icon"*ngIf="i > 0" (click)="removeKinshipRelation(i)">
                                        <span class="font-size-18px">&times;</span>
                                    </button>
                                </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                </div>
                <div class="row justify-content-between ml-10">
                    <button class="btn btn-icon" (click)="addKinshipRelation()"><span class="font-size-18px">+</span></button>
                </div>
                <div class="row justify-content-end m-7">
                    <button class="btn btn-success" *ngIf="addOrEditKinshipRelationButton"
                        [disabled]="kinshipRelationForm && kinshipRelationForm.invalid "(click)="creteKinshipRelation()">{{'stepper.button-update' | translate}}</button>
                    <button class="btn btn-success" *ngIf="!addOrEditKinshipRelationButton"
                        [disabled]="kinshipRelationForm && kinshipRelationForm.invalid" (click)="creteKinshipRelation()">{{'stepper.button-add' | translate}}</button>
                </div>
            </div>
        </form>
        <form *ngIf="kinshipRelationCriminalDataForm" class="col border" [formGroup]="kinshipRelationCriminalDataForm">
            <app-loading-spinner *ngIf="isLoadingKinshipRelationCriminalData" contentHeight="20rem" height="5rem" width="5rem"
            colorClass="text-primary"></app-loading-spinner>
            <div *ngIf="!isLoadingKinshipRelationCriminalData" >
                <div class="row my-5">
                    <div class="col">
                        <h4>{{'material-status.kinship-criminal-data-name' | translate}}</h4>
                    </div>
                </div>
                <div class="row ml-10 mr-10" >
                                <ckeditor [editor]="Editor" class="w-100" name="editor1" skin="moono-lisa" language="en"
                                formControlName="text"  (ready)="onReady($event)"></ckeditor>
                </div>
                <div class="row justify-content-end m-7">
                    <button class="btn btn-success" *ngIf="addOrEditKinshipRelationCriminalDataButton"
                        [disabled]="kinshipRelationCriminalDataForm.value.text == null || kinshipRelationCriminalDataForm.value.text == '' " (click)="updateKinshipRelationCriminalData()">{{'stepper.button-update' | translate}}</button>
                    <button class="btn btn-success" *ngIf="!addOrEditKinshipRelationCriminalDataButton"
                        [disabled]="kinshipRelationCriminalDataForm.value.text == null || kinshipRelationCriminalDataForm.value.text == '' " (click)="createKinshipRelationCriminalData()">{{'stepper.button-add' | translate}}</button>
                </div>
            </div>
        </form>
    </div>
</div>
