<div class="modal-header px-7">
	<div class="d-flex justify-content-between w-100">
		<h3 class="modal-title">{{'button.attach-evaluateds' | translate}}</h3>
		<div class="d-flex gap-2">
			<a (click)="view = modalViewEnum.isTable" href="javascript:void(0)" class="btn btn-icon btn-hover-light btn-lg mr-4" content="body" ngbTooltip="Tabel mod">
				<span class="svg-icon">
					<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
						<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
							<rect x="0" y="0" width="24" height="24"/>
							<rect fill="#000000" x="2" y="5" width="19" height="4" rx="1"/>
							<rect fill="#000000" opacity="0.3" x="2" y="11" width="19" height="10" rx="1"/>
						</g>
					</svg>
				</span>
			</a>
			<a (click)="view = modalViewEnum.isOrganigram" [ngClass]="{'pulse pulse-danger': view != modalViewEnum.isOrganigram }" 
			href="javascript:void(0)" class="btn btn-icon btn-hover-light btn-lg mr-4" content="body" ngbTooltip="Organigrama mod">
				<span *ngIf="view != modalViewEnum.isOrganigram" class="pulse-ring"></span>
				<span class="svg-icon">
					<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
						<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
							<rect x="0" y="0" width="24" height="24"/>
							<rect fill="#000000" x="9" y="5" width="13" height="14" rx="1.5"/>
							<rect fill="#000000" opacity="0.3" x="2" y="5" width="5" height="14" rx="1"/>
						</g>
					</svg>
				</span>
			</a>
		</div>
	</div>
</div>
<div class="modal-body px-7">
	<div *ngIf="view === modalViewEnum.isTable">
		<div class="row mb-lg-4 mb-0">
			<div class="col-lg col-12">
				<erp-shared-search-input (handleSearch)="setFilter('lastName', $event)"
					[placeholder]="'attach-user-modal.last-name' | translate" #lastName></erp-shared-search-input>
			</div>
			<div class="col-lg col-12 pt-lg-0 pt-2">
				<erp-shared-search-input (handleSearch)="setFilter('firstName', $event)"
					[placeholder]="'attach-user-modal.first-name' | translate" #firstName></erp-shared-search-input>
			</div>
			<div class="col-lg col-12 pt-lg-0 pt-2">
				<erp-shared-search-input (handleSearch)="setFilter('fatherName', $event)"
				[placeholder]="'attach-user-modal.father-name' | translate" #fatherName></erp-shared-search-input>
			</div>
			<div class="col-lg col-12 pt-lg-0 pt-2">
				<erp-shared-search-input (handleSearch)="setFilter('idnp', $event)"
					[placeholder]="'attach-user-modal.idnp' | translate" #idnp></erp-shared-search-input>
			</div>
			<div class="col-lg col-12 pt-lg-0 pt-2">
				<erp-shared-search-input (handleSearch)="setFilter('email', $event)"
					[placeholder]="'attach-user-modal.email'  | translate" #email></erp-shared-search-input>
			</div>
		</div>
		<div class="row">
			<div class="col-lg col-12 pt-lg-0 pt-2">
				<erp-shared-select [items]="departments" (filter)="setFilter('departmentId',  $event)" [placeholder]="'attach-user-modal.search-department' | translate"></erp-shared-select>
			</div>
			<div class="col-lg col-12 pt-lg-0 pt-2">
				<erp-shared-select [items]="roles" (filter)="setFilter('roleId',  $event)" [placeholder]="'attach-user-modal.search-role' | translate"></erp-shared-select>
			</div>
			<div class="col-lg col-12 pt-lg-0 pt-2">
				<erp-shared-select [items]="functions" (filter)="setFilter('functionId',  $event)" [placeholder]="'attach-user-modal.search-function' | translate"></erp-shared-select>
			</div>
			<div class="col-lg col-12 pt-lg-0 pt-2">
				<erp-shared-select [items]="userStatuses" (filter)="setFilter('roleId',  $event)" [placeholder]="'attach-user-modal.search-user-status' | translate"></erp-shared-select>
			</div>
			<div class="d-lg-block d-none col-lg-auto col-12 pt-lg-0 pt-2">
				<app-button (click)="resetFilters()">{{'button.reset-filters' | translate}}</app-button>
			</div>
			<div class="d-lg-none d-block col-lg-auto col-12 pt-lg-0 pt-2">
				<app-button class="w-100" width="100%" (click)="resetFilters()">{{'button.reset-filters' | translate}}</app-button>
			</div>
		</div>
	
		<app-loading-spinner *ngIf="isLoading" [contentHeight]="'40vh'" [height]="'5rem'" [width]="'5rem'"
			[colorClass]="'text-primary'">
		</app-loading-spinner>
	
		<div class="table-responsive datatable datatable-bordered datatable-head-custom datatable-default datatable-primary datatable-loaded"
		id="kt_datatable">
		<table class="datatable table font-size-lg" style="overflow: visible" *ngIf="!isLoading">
			<thead class="text-uppercase text-muted">
				<tr>
					<th scope="col" style="width: 50px">
						<span>
							<label class="checkbox checkbox-lg checkbox-inline" [ngbTooltip]="tooltip">
								<input type="checkbox" value="" name="option"
									[checked]="paginatedAttachedIds"
									(change)="checkAll($event)" />
								<span></span>
							</label>
						</span>
					</th>
					<th scope="col"> {{ 'attach-user-modal.last-name' | translate }} ({{ 'attach-user-modal.npp' | translate }}) </th>
					<th scope="col"> {{ 'attach-user-modal.idnp' | translate }} </th>
					<th scope="col"> {{ 'attach-user-modal.email' | translate }} </th>
					<th scope="col"> {{ 'attach-user-modal.department' | translate }} </th>
					<th scope="col"> {{ 'attach-user-modal.role' | translate }} </th>
				</tr>
			</thead>
			<tbody class="datatable-body">
				<tr *ngFor="let user of users">
					<td>
						<label class="checkbox checkbox-lg checkbox-inline">
							<input #currentCheckbox type="{{inputType}}" value="{{ user.id }}" name="option"
								[checked]="attachedUsers.includes(user.id)" (change)="checkInput($event)" />
							<span></span>
						</label>
					</td>
					<td> <a class="text-dark-75 text-hover-primary" (click)="currentCheckbox.click()" href="javascript:void(0)">{{ user.lastName }} {{ user.firstName }} {{ user.fatherName }}</a></td>
					<td> {{ user.idnp }} </td>
					<td> {{ user.email }} </td>
					<td>
						<span *ngIf="!user.departmentName">-</span> 
						<span *ngIf="user.departmentName">{{ user.departmentName }}</span> 
					</td>
					<td> 
						<span *ngIf="!user.roleName">-</span> 
						<span *ngIf="user.roleName">{{ user.roleName }}</span>
					</td>
				</tr>
			</tbody>
			<tbody class="datatable-body">
				<tr *ngIf="!users.length">
					<td colspan="6" class="text-center">
						{{ 'message.no-record' | translate }}
					</td>
				</tr>
			</tbody>
		</table>
		<div pagination class="datatable-pager datatable-paging-loaded mb-5" [page]="pagination.currentPage" 
			*ngIf="users" [total]="pagination.totalPages" [totalRecords]="pagination.totalCount" [size]="pagination.pageSize"
			(sizeChange)="getUsers({ page: 1, itemsPerPage: $event})"
			(pageChange)="getUsers({ page: $event, itemsPerPage: pagination.pageSize})">
		</div>
		</div>
	</div>
	<div *ngIf="view === modalViewEnum.isOrganigram" class="row gap-2 container-block">
		<div class="col-lg col-12 border p-4 tree-container">
			<div class="row mb-lg-4 mb-0">
				<div class="col-lg col-12">
					<erp-shared-search-input (handleSearch)="setFilter('lastName', $event)"
						[placeholder]="'attach-user-modal.last-name' | translate" #lastName></erp-shared-search-input>
				</div>
				<div class="col-lg col-12 pt-lg-0 pt-2">
					<erp-shared-search-input (handleSearch)="setFilter('firstName', $event)"
						[placeholder]="'attach-user-modal.first-name' | translate" #firstName></erp-shared-search-input>
				</div>
				<div class="col-lg col-12 pt-lg-0 pt-2">
					<erp-shared-search-input (handleSearch)="setFilter('fatherName', $event)"
					[placeholder]="'attach-user-modal.father-name' | translate" #fatherName></erp-shared-search-input>
				</div>
				<div class="col-lg col-12 pt-lg-0 pt-2">
					<erp-shared-search-input (handleSearch)="setFilter('idnp', $event)"
						[placeholder]="'attach-user-modal.idnp' | translate" #idnp></erp-shared-search-input>
				</div>
				<div class="col-lg col-12 pt-lg-0 pt-2">
					<erp-shared-search-input (handleSearch)="setFilter('email', $event)"
						[placeholder]="'attach-user-modal.email'  | translate" #email></erp-shared-search-input>
				</div>
			</div>
			<div class="row">
				<div class="col-lg col-12 pt-lg-0 pt-2">
					<erp-shared-select [items]="departments" (filter)="setFilter('departmentId',  $event)" [placeholder]="'attach-user-modal.search-department' | translate"></erp-shared-select>
				</div>
				<div class="col-lg col-12 pt-lg-0 pt-2">
					<erp-shared-select [items]="roles" (filter)="setFilter('roleId',  $event)" [placeholder]="'attach-user-modal.search-role' | translate"></erp-shared-select>
				</div>
				<div class="col-lg col-12 pt-lg-0 pt-2">
					<erp-shared-select [items]="functions" (filter)="setFilter('functionId',  $event)" [placeholder]="'attach-user-modal.search-function' | translate"></erp-shared-select>
				</div>
				<div class="col-lg col-12 pt-lg-0 pt-2">
					<erp-shared-select [items]="userStatuses" (filter)="setFilter('roleId',  $event)" [placeholder]="'attach-user-modal.search-user-status' | translate"></erp-shared-select>
				</div>
				<div class="d-lg-block d-none col-lg-auto col-12 pt-lg-0 pt-2">
					<app-button (click)="resetFilters()">{{'button.reset-filters' | translate}}</app-button>
				</div>
				<div class="d-lg-none d-block col-lg-auto col-12 pt-lg-0 pt-2">
					<app-button class="w-100" width="100%" (click)="resetFilters()">{{'button.reset-filters' | translate}}</app-button>
				</div>
			</div>
		
			<app-loading-spinner *ngIf="isLoading" [contentHeight]="'40vh'" [height]="'5rem'" [width]="'5rem'"
				[colorClass]="'text-primary'">
			</app-loading-spinner>
		
			<div class="table-responsive datatable datatable-bordered datatable-head-custom datatable-default datatable-primary datatable-loaded"
			id="kt_datatable">
			<table class="datatable table font-size-lg" style="overflow: visible" *ngIf="!isLoading">
				<thead class="text-uppercase text-muted">
					<tr>
						<th scope="col" style="width: 50px">
							<span>
								<label class="checkbox checkbox-lg checkbox-inline" [ngbTooltip]="tooltip">
									<input type="checkbox" value="" name="option"
										[checked]="paginatedAttachedIds"
										(change)="checkAll($event)" />
									<span></span>
								</label>
							</span>
						</th>
						<th scope="col"> {{ 'attach-user-modal.last-name' | translate }} ({{ 'attach-user-modal.npp' | translate }}) </th>
						<th scope="col"> {{ 'attach-user-modal.idnp' | translate }} </th>
						<th scope="col"> {{ 'attach-user-modal.email' | translate }} </th>
						<th scope="col"> {{ 'attach-user-modal.department' | translate }} </th>
						<th scope="col"> {{ 'attach-user-modal.role' | translate }} </th>
					</tr>
				</thead>
				<tbody class="datatable-body">
					<tr *ngFor="let user of users">
						<td>
							<label class="checkbox checkbox-lg checkbox-inline">
								<input #currentCheckbox type="{{inputType}}" value="{{ user.id }}" name="option"
									[checked]="attachedUsers.includes(user.id)" (change)="checkInput($event)" />
								<span></span>
							</label>
						</td>
						<td> <a class="text-dark-75 text-hover-primary" (click)="currentCheckbox.click()" href="javascript:void(0)">{{ user.lastName }} {{ user.firstName }} {{ user.fatherName }}</a></td>
						<td> {{ user.idnp }} </td>
						<td> {{ user.email }} </td>
						<td>
							<span *ngIf="!user.departmentName">-</span> 
							<span *ngIf="user.departmentName">{{ user.departmentName }}</span> 
						</td>
						<td> 
							<span *ngIf="!user.roleName">-</span> 
							<span *ngIf="user.roleName">{{ user.roleName }}</span>
						</td>
					</tr>
				</tbody>
				<tbody class="datatable-body">
					<tr *ngIf="!users.length">
						<td colspan="6" class="text-center">
							{{ 'message.no-record' | translate }}
						</td>
					</tr>
				</tbody>
			</table>
			<div pagination class="datatable-pager datatable-paging-loaded mb-5" [page]="pagination.currentPage" 
				*ngIf="users" [total]="pagination.totalPages" [totalRecords]="pagination.totalCount" [size]="pagination.pageSize"
				(sizeChange)="getUsers({ page: 1, itemsPerPage: $event})"
				(pageChange)="getUsers({ page: $event, itemsPerPage: pagination.pageSize})">
			</div>
			</div>
		</div>
		<div class="col-lg col-12 border p-4 tree-container">
			<erp-shared-tree [attachedUsers]="attachedUsers" (changeAttachedUser)="handleChangeAttachedUsers($event)"></erp-shared-tree>
		</div>
	</div>
</div>

<div class="modal-footer d-lg-flex d-none">
	<button type="button" class="btn btn-secondary" (click)="dismiss()">{{'button.cancel' | translate}}</button>
	<button type="button" class="btn btn-primary" (click)="confirm()">{{'button.confirm' | translate}}</button>
</div>
<div class="modal-footer d-lg-none d-flex">
	<button type="button" class="btn btn-primary w-100" (click)="confirm()">{{'button.confirm' | translate}}</button>
	<button type="button" class="btn btn-secondary w-100 pt-2" (click)="dismiss()">{{'button.cancel' | translate}}</button>
</div>
<ng-template #tooltip>
	<p class="mb-0 font-size-sm" *ngIf="paginatedAttachedIds">{{'button.uncheck-all' | translate}}</p>
	<p class="mb-0 font-size-sm" *ngIf="!paginatedAttachedIds">{{'button.check-all' | translate}}</p>
</ng-template>
